{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Application — {{ app.first_name }} {{ app.last_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'home/css/style.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

<!-- ========== NAVBAR ========== -->
<nav class="navbar">
    <div class="navbar-left d-flex align-items-center gap-2">
        <div class="logo">
            <div class="logo-circle">
                <span class="logo-text">CHMSU</span>
            </div>
        </div>
        <a href="{% url 'home:staff_dashboard' %}" class="btn btn-nav btn-nav--link">
            <i class="fa-solid fa-arrow-left"></i>
            <span>Back to Dashboard</span>
        </a>
    </div>
    <div class="navbar-right d-flex align-items-center gap-2">
        <span class="btn btn-nav btn-nav--active" style="cursor: default;">
            <i class="fa-solid fa-magnifying-glass-plus"></i>
            <span>Review Application</span>
        </span>
    </div>
</nav>

<!-- ========== MAIN CONTENT ========== -->
<main class="main-content">

    <!-- ── Application Header Banner ── -->
    <div class="status-banner">
        <div class="status-banner-bg"></div>
        <div class="status-banner-content">
            <div class="status-icon-wrap">
                {% if app.status == 'approved' %}
                    <i class="fa-solid fa-circle-check"></i>
                {% elif app.status == 'rejected' %}
                    <i class="fa-solid fa-circle-xmark"></i>
                {% elif app.status == 'under_review' %}
                    <i class="fa-solid fa-magnifying-glass"></i>
                {% else %}
                    <i class="fa-solid fa-hourglass-half"></i>
                {% endif %}
            </div>
            <div class="status-text">
                <div class="status-label-row">
                    <span class="status-label">Application Review</span>
                    <span class="status-badge
                        {% if app.status == 'approved' %} status-badge--approved
                        {% elif app.status == 'rejected' %} status-badge--rejected
                        {% else %} status-badge--review{% endif %}">
                        <i class="fa-solid fa-circle" style="font-size:6px;"></i>
                        {{ app.get_status_display }}
                    </span>
                </div>
                <h2 class="status-title">{{ app.first_name }} {{ app.middle_initial }}. {{ app.last_name }}{% if app.extension_name %} {{ app.extension_name }}{% endif %}</h2>
                <p class="status-message">Student ID: {{ app.student_id }} &mdash; Submitted {{ app.submitted_at|date:"F d, Y h:i A" }}</p>
            </div>
        </div>
        <div class="status-decoration">
            <i class="fa-solid fa-user-graduate"></i>
        </div>
    </div>

    <!-- ── Status Action Bar ── -->
    <div class="review-action-bar">
        <span class="review-action-label">Update Status:</span>
        <form method="post" action="{% url 'home:staff_update_application_status' app.pk %}" class="review-action-form">
            {% csrf_token %}
            <input type="hidden" name="next" value="{% url 'home:staff_review_application' app.pk %}">
            <button type="submit" name="status" value="pending" class="review-status-btn review-btn--pending {% if app.status == 'pending' %}review-btn--current{% endif %}">
                <i class="fa-solid fa-clock"></i> Pending
            </button>
            <button type="submit" name="status" value="under_review" class="review-status-btn review-btn--under_review {% if app.status == 'under_review' %}review-btn--current{% endif %}">
                <i class="fa-solid fa-magnifying-glass"></i> Under Review
            </button>
            <button type="submit" name="status" value="approved" class="review-status-btn review-btn--approved {% if app.status == 'approved' %}review-btn--current{% endif %}">
                <i class="fa-solid fa-circle-check"></i> Approve
            </button>
            <button type="submit" name="status" value="rejected" class="review-status-btn review-btn--rejected {% if app.status == 'rejected' %}review-btn--current{% endif %}">
                <i class="fa-solid fa-circle-xmark"></i> Reject
            </button>
        </form>
    </div>

    <!-- ── Two-Column Info ── -->
    <div class="review-grid">

        <!-- LEFT: Personal & Academic Info -->
        <div class="staff-panel">
            <div class="staff-panel-header">
                <div class="staff-panel-header-left">
                    <span class="staff-panel-icon staff-panel-icon--green"><i class="fa-solid fa-user"></i></span>
                    <h3 class="staff-panel-title">Personal Information</h3>
                </div>
            </div>
            <div class="review-info-grid">
                <div class="review-field">
                    <span class="review-field-label">Full Name</span>
                    <span class="review-field-value">{{ app.first_name }} {{ app.middle_initial }}. {{ app.last_name }}{% if app.extension_name %} {{ app.extension_name }}{% endif %}</span>
                </div>
                <div class="review-field">
                    <span class="review-field-label">Date of Birth</span>
                    <span class="review-field-value">{{ app.date_of_birth|date:"F d, Y" }}</span>
                </div>
                <div class="review-field">
                    <span class="review-field-label">Gender</span>
                    <span class="review-field-value">{{ app.get_gender_display }}</span>
                </div>
                <div class="review-field">
                    <span class="review-field-label">Contact Number</span>
                    <span class="review-field-value">{{ app.contact_number }}</span>
                </div>
                <div class="review-field">
                    <span class="review-field-label">Email Address</span>
                    <span class="review-field-value">{{ app.email }}</span>
                </div>
                <div class="review-field review-field--full">
                    <span class="review-field-label">Home Address</span>
                    <span class="review-field-value">{{ app.address }}</span>
                </div>
            </div>

            <div class="staff-panel-header" style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                <div class="staff-panel-header-left">
                    <span class="staff-panel-icon staff-panel-icon--blue"><i class="fa-solid fa-graduation-cap"></i></span>
                    <h3 class="staff-panel-title">Academic Information</h3>
                </div>
            </div>
            <div class="review-info-grid">
                <div class="review-field">
                    <span class="review-field-label">Student ID</span>
                    <span class="review-field-value" style="color: #1a5632; font-weight: 700;">{{ app.student_id }}</span>
                </div>
                <div class="review-field">
                    <span class="review-field-label">Course / Program</span>
                    <span class="review-field-value">{{ app.course }}</span>
                </div>
                <div class="review-field">
                    <span class="review-field-label">Year Level</span>
                    <span class="review-field-value">{{ app.get_year_level_display }}</span>
                </div>
                <div class="review-field">
                    <span class="review-field-label">Semester</span>
                    <span class="review-field-value">{{ app.get_semester_display }}</span>
                </div>
            </div>
        </div>

        <!-- RIGHT: Documents -->
        <div class="staff-panel">
            <div class="staff-panel-header">
                <div class="staff-panel-header-left">
                    <span class="staff-panel-icon staff-panel-icon--amber"><i class="fa-solid fa-folder-open"></i></span>
                    <h3 class="staff-panel-title">Submitted Documents</h3>
                </div>
                <span class="staff-panel-count" style="background: {% if uploaded_docs == total_docs %}#dcfce7; color:#166534;{% else %}#fef3c7; color:#92400e;{% endif %}">
                    {{ uploaded_docs }}/{{ total_docs }}
                </span>
            </div>

            <!-- Progress bar -->
            <div class="review-doc-progress">
                <div class="review-doc-progress-bar" style="width: {% widthratio uploaded_docs total_docs 100 %}%;"></div>
            </div>

            <div class="review-doc-list">
                {% for doc in documents %}
                <div class="review-doc-item review-doc--{% if doc.uploaded %}uploaded{% else %}missing{% endif %}">
                    <div class="review-doc-status">
                        {% if doc.uploaded %}
                            <i class="fa-solid fa-circle-check" style="color: #16a34a;"></i>
                        {% else %}
                            <i class="fa-solid fa-circle-xmark" style="color: #dc2626;"></i>
                        {% endif %}
                    </div>
                    <div class="review-doc-info">
                        <span class="review-doc-name">{{ doc.name }}</span>
                        {% if doc.uploaded %}
                            <a href="{{ doc.file.url }}" target="_blank" class="review-doc-link">
                                <i class="fa-solid fa-arrow-up-right-from-square"></i> View File
                            </a>
                        {% else %}
                            <span class="review-doc-missing">Not submitted</span>
                        {% endif %}
                    </div>
                    <div class="review-doc-badge">
                        {% if doc.uploaded %}
                            <span class="staff-status-tag staff-status--approved" style="font-size:10px;">Submitted</span>
                        {% else %}
                            <span class="staff-status-tag staff-status--rejected" style="font-size:10px;">Missing</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
